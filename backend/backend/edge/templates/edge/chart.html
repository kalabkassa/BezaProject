{% extends 'edge/navbar.html' %} 
{% block title %}Vital Signs Chart{% endblock title %} 
{% block content %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<div class="container">
    <h1>Search Results</h1>
    <form method="GET" action="{% url 'vital' %}" class="mb-4">
        {% csrf_token %} {{ form }}
        <button type="submit" class="btn btn-primary">Search</button>
    </form>
    {% for d in data %}
    <div class="patient">
        <div class="patient-header">
            <h2>{{ d.name }}</h2>
        </div>
        <div class="patient-content">
            <div class="chart-container">
                <canvas id="{{ d.name }}-chart"></canvas>
            </div>
            <script>
                document.addEventListener('DOMContentLoaded', function () {
                    var ctx = document.getElementById("{{ d.name }}-chart").getContext('2d');
                    // Your chart initialization and data code here

                    // <block:data:2>
                    const data = {{d.heart_rates}};
                    const data2 = {{d.temperature}};
                    let prev = 100;
                    let prev2 = 80;
                    for (let i = 0; i < 1000; i++) {
                        prev += 5 - Math.random() * 10;
                        data.push({x: i, y: prev});
                        prev2 += 5 - Math.random() * 10;
                        data2.push({x: i, y: prev2});
                    }
                    // </block:data>

                    // <block:animation:1>
                    const totalDuration = 10000;
                    const delayBetweenPoints = totalDuration / data.length;
                    const previousY = (ctx) => ctx.index === 0 ? ctx.chart.scales.y.getPixelForValue(100) : ctx.chart.getDatasetMeta(ctx.datasetIndex).data[ctx.index - 1].getProps(['y'], true).y;
                    const animation = {
                    x: {
                        type: 'number',
                        easing: 'linear',
                        duration: delayBetweenPoints,
                        from: NaN, // the point is initially skipped
                        delay(ctx) {
                        if (ctx.type !== 'data' || ctx.xStarted) {
                            return 0;
                        }
                        ctx.xStarted = true;
                        return ctx.index * delayBetweenPoints;
                        }
                    },
                    y: {
                        type: 'number',
                        easing: 'linear',
                        duration: delayBetweenPoints,
                        from: previousY,
                        delay(ctx) {
                        if (ctx.type !== 'data' || ctx.yStarted) {
                            return 0;
                        }
                        ctx.yStarted = true;
                        return ctx.index * delayBetweenPoints;
                        }
                    }
                    };
                    // </block:animation>

                    // <block:config:0>
                    const chart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: {{d.timestamps|safe}},
                            datasets: [{
                                label: "Heart Rate",
                                borderColor: 'rgb(255,99,132)',
                                borderWidth: 1,
                                radius: 0,
                                data: data,
                            },
                            {
                                label: "Temprature",
                                borderColor: 'rgb(54,162,235)',
                                borderWidth: 1,
                                radius: 0,
                                data: data2,
                            }]
                        },
                        options: {
                            animation,
                            interaction: {
                            intersect: false
                            },
                            plugins: {
                            legend: false
                            },
                            scales: {
                                x: {
                                    display: true,
                                    title: {
                                        display: true,
                                        text: 'Timestamp'
                                    }
                                },
                                y: {
                                    display: true,
                                    title: {
                                        display: true,
                                        text: 'Value'
                                    }
                                }
                            }
                        }
                    });
                    // </block:config>
                });
            </script>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock content %}
